// ============================================================
// ТЕМА: Комплексна робота з множинними елементами
// ОПИС: Демонстрація комбінації різних методів для роботи
//       з множинами елементів у складних сценаріях
// ============================================================

describe('Комплексна робота з множинними елементами', () => {
  // Підготовка: відкриваємо сторінку та додаємо різноманітні дані
  beforeEach(() => {
    cy.visit('/')
    cy.get('.new-todo').type('Активна 1{enter}')
    cy.get('.new-todo').type('Активна 2{enter}')
    cy.get('.new-todo').type('Виконана 1{enter}')
    cy.get('.new-todo').type('Виконана 2{enter}')
    // Відмічаємо останні дві задачі
    cy.get('.todo-list li').eq(2).find('.toggle').check()
    cy.get('.todo-list li').eq(3).find('.toggle').check()
  })

  // Тест 1: Комбінація each() з filter()
  // Використання each() для ітерації по відфільтрованих елементах
  it('має комбінувати each() з filter()', () => {
    // Фільтруємо тільки активні задачі
    cy.get('.todo-list li')
      .filter(':not(.completed)')
      // Ітеруємо через кожну активну задачу
      .each(($el) => {
        cy.wrap($el)
          .should('not.have.class', 'completed')
      })
  })

  // Тест 2: Збір даних з множини елементів
  // Використання each() для збору даних з множини
  it('має збирати дані з множини елементів', () => {
    const activeTasks = []
    const completedTasks = []
    
    // Збираємо дані про активні та виконані задачі
    cy.get('.todo-list li')
      .each(($el) => {
        const text = $el.text()
        if ($el.hasClass('completed')) {
          completedTasks.push(text)
        } else {
          activeTasks.push(text)
        }
      })
      .then(() => {
        // Перевіряємо зібрані дані
        expect(activeTasks).to.have.length(2)
        expect(completedTasks).to.have.length(2)
      })
  })

  // Тест 3: Масові операції з умовами
  // Виконання різних операцій залежно від стану елемента
  it('має виконувати масові операції з умовами', () => {
    // Відмічаємо всі активні задачі
    cy.get('.todo-list li')
      .filter(':not(.completed)')
      .each(($el) => {
        cy.wrap($el)
          .find('.toggle')
          .check()
      })
    
    // Перевіряємо, що всі задачі тепер виконані
    cy.get('.todo-list li.completed')
      .should('have.length', 4)
  })

  // Тест 4: Навігація по множині елементів
  // Використання навігаційних методів для роботи з множинами
  it('має навігувати по множині елементів', () => {
    // Знаходимо перший елемент
    cy.get('.todo-list li')
      .first()
      // Знаходимо всі наступні
      .nextAll()
      .should('have.length', 3)
    
    // Знаходимо останній елемент
    cy.get('.todo-list li')
      .last()
      // Знаходимо всі попередні
      .prevAll()
      .should('have.length', 3)
  })

  // Тест 5: Практичний сценарій - комплексна робота
  // Реальний приклад комплексної роботи з множинами
  it('має демонструвати комплексну роботу з множинами', () => {
    // Підраховуємо активні та виконані задачі
    cy.get('.todo-list li')
      .filter(':not(.completed)')
      .should('have.length', 2)
    
    cy.get('.todo-list li')
      .filter('.completed')
      .should('have.length', 2)
    
    // Відмічаємо всі активні
    cy.get('.todo-list li')
      .filter(':not(.completed)')
      .each(($el) => {
        cy.wrap($el)
          .find('.toggle')
          .check()
      })
    
    // Перевіряємо результат
    cy.get('.todo-list li.completed')
      .should('have.length', 4)
  })
})

// ============================================================
// НАЙКРАЩІ ПРАКТИКИ для роботи з множинними елементами:
// ============================================================
// 1. Використовуйте filter() перед each() для обмеження колекції
// 2. Збирайте дані в масиви через each() та .then()
// 3. Використовуйте first() та last() для крайніх елементів
// 4. Комбінуйте навігаційні методи для складних пошуків
// 5. Документуйте складні операції коментарями
// ============================================================
