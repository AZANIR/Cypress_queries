// ============================================================
// ТЕМА: CSS Селектори в Cypress
// ОПИС: Демонстрація різних способів використання CSS селекторів
//       для пошуку елементів на сторінці TodoMVC
// ============================================================

describe('CSS Селектори - основні типи', () => {
  // Підготовка: відкриваємо сторінку TodoMVC перед кожним тестом
  // cy.visit() - команда для навігації на сторінку
  // '/' - відносний шлях, який використовує baseUrl з cypress.config.js
  beforeEach(() => {
    cy.visit('/')
  })

  // Тест 1: Пошук елементів за класом CSS
  // Класи - найпоширеніший спосіб вибору елементів
  it('має знайти елементи за класом CSS', () => {
    // cy.get('.new-todo') - знаходить елемент з класом 'new-todo'
    // Крапка (.) перед назвою означає, що це клас CSS
    // Це поле вводу для нових задач у TodoMVC
    cy.get('.new-todo')
      // .should('be.visible') - перевіряє, що елемент видимий на сторінці
      // Це важливо, бо невидимі елементи не можна використовувати
      .should('be.visible')
    
    // Пошук за класом 'todo-list' - це контейнер для списку задач
    // Поки що список порожній, але елемент існує
    cy.get('.todo-list')
      // .should('exist') - перевіряє наявність елемента в DOM
      // На відміну від 'be.visible', 'exist' працює навіть для прихованих елементів
      .should('exist')

    cy.xpath('//button[contains(text(),"Submit")]').click();
    cy.get('button').should('contain', 'Submit').click();
    cy.contains('button', 'Submit').click();
  })

  // Тест 2: Пошук елементів за HTML тегом
  // Іноді зручніше вибирати елементи за типом тега
  it('має знайти елементи за HTML тегом', () => {
    // cy.get('h1') - знаходить всі заголовки першого рівня
    // У TodoMVC це заголовок "todos"
    cy.get('h1')
      // .should('contain', 'todos') - перевіряє, що текст містить слово "todos"
      // 'contain' працює з частковим співпадінням (не повинен точно відповідати)
      .should('contain', 'todos')
    
    // cy.get('input') - знаходить всі input елементи на сторінці
    // У TodoMVC є поле вводу для нових задач
    cy.get('input')
      // .should('have.length', 1) - перевіряє кількість знайдених елементів
      // Має бути рівно один input елемент
      .should('have.length', 1)
  })

  // Тест 3: Пошук елементів за атрибутами
  // Атрибути - дуже стабільний спосіб вибору елементів
  it('має знайти елементи за атрибутами', () => {
    // cy.get('[type="text"]') - знаходить елементи з атрибутом type="text"
    // Квадратні дужки [] використовуються для вибору за атрибутами
    cy.get('[type="text"]')
      .should('be.visible')
    
    // cy.get('[placeholder="What needs to be done?"]') - пошук за placeholder
    // Placeholder - це текст-підказка, який показується в порожньому полі
    cy.get('[placeholder="What needs to be done?"]')
      .should('exist')
    
    // Комбінація: пошук input з конкретним класом та типом
    // Це більш специфічний селектор, який знайде саме поле вводу задач
    cy.get('input.new-todo[type="text"]')
      .should('be.visible')
  })

  // Тест 4: Комбіновані CSS селектори
  // Комбінування різних типів селекторів для точнішого вибору
  it('має використовувати комбіновані селектори', () => {
    // Додаємо кілька задач для демонстрації
    // cy.get('.new-todo') - знаходимо поле вводу
    // .type('Задача 1{enter}') - вводимо текст та натискаємо Enter
    // {enter} - спеціальний символ для натискання клавіші Enter
    cy.get('.new-todo').type('Задача 1{enter}')
    cy.get('.new-todo').type('Задача 2{enter}')
    cy.get('.new-todo').type('Задача 3{enter}')
    
    // cy.get('.todo-list li') - знаходить всі елементи <li> всередині .todo-list
    // Пробіл між селекторами означає "будь-який нащадок" (не обов'язково прямий)
    cy.get('.todo-list li')
      // Перевіряємо, що створилося рівно 3 задачі
      .should('have.length', 3)
    
    // cy.get('.todo-list > li') - знаходить тільки прямі дочірні елементи
    // Символ > означає "прямий дочірній елемент"
    // У TodoMVC структура саме така, тому результат буде такий самий
    cy.get('.todo-list > li')
      .should('have.length', 3)
  })

  // Тест 5: Псевдокласи та структурні селектори
  // CSS підтримує псевдокласи для вибору елементів за позицією
  it('має використовувати псевдокласи для вибору за позицією', () => {
    // Додаємо задачі для тестування
    cy.get('.new-todo').type('Перша задача{enter}')
    cy.get('.new-todo').type('Друга задача{enter}')
    cy.get('.new-todo').type('Третя задача{enter}')
    
    // cy.get('.todo-list li:first-child') - знаходить перший елемент списку
    // :first-child - псевдоклас для першого дочірнього елемента
    cy.get('.todo-list li:first-child')
      // Перевіряємо, що перша задача містить правильний текст
      .should('contain', 'Перша задача')
    
    // cy.get('.todo-list li:last-child') - знаходить останній елемент списку
    // :last-child - псевдоклас для останнього дочірнього елемента
    cy.get('.todo-list li:last-child')
      .should('contain', 'Третя задача')
    
    // cy.get('.todo-list li:nth-child(2)') - знаходить другий елемент
    // :nth-child(n) - псевдоклас для n-го дочірнього елемента
    // Увага: нумерація починається з 1, а не з 0!
    cy.get('.todo-list li:nth-child(2)')
      .should('contain', 'Друга задача')
  })

  // Тест 6: Селектори за станом елемента
  // Можна вибирати елементи за їх станом (видимість, активність тощо)
  it('має знаходити елементи за станом', () => {
    // Додаємо задачу та відмічаємо її як виконану
    cy.get('.new-todo').type('Виконана задача{enter}')
    
    // Знаходимо чекбокс для відмітки задачі як виконаної
    // .toggle - це клас чекбокса в TodoMVC
    cy.get('.todo-list li .toggle')
      // .check() - встановлює чекбокс у вибраний стан
      .check()
    
    // cy.get('.todo-list li.completed') - знаходить задачі з класом 'completed'
    // Клас 'completed' додається автоматично, коли задача відмічена
    cy.get('.todo-list li.completed')
      // Перевіряємо, що знайдено рівно одну виконану задачу
      .should('have.length', 1)
      // Перевіряємо, що вона містить правильний текст
      .should('contain', 'Виконана задача')
  })
})

// ============================================================
// НАЙКРАЩІ ПРАКТИКИ для CSS селекторів:
// ============================================================
// 1. Віддавайте перевагу класам та data-атрибутам замість тегів
// 2. Уникайте селекторів, що залежать від позиції (:nth-child)
// 3. Використовуйте специфічні селектори для уникнення помилок
// 4. Комбінуйте селектори для точнішого вибору
// 5. Перевіряйте видимість елементів перед взаємодією
// ============================================================
