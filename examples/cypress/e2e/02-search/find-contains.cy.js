// ============================================================
// ТЕМА: Методи find() та contains() - пошук вкладених елементів та за текстом
// ОПИС: Демонстрація використання find() для пошуку всередині елемента
//       та contains() для пошуку елементів за текстовим вмістом
// ============================================================

describe('Методи find() та contains() - пошук вкладених елементів', () => {
  // Підготовка: відкриваємо сторінку та додаємо тестові дані
  beforeEach(() => {
    cy.visit('/')
    // Додаємо кілька задач для тестування
    cy.get('.new-todo').type('Перша задача{enter}')
    cy.get('.new-todo').type('Друга задача{enter}')
    cy.get('.new-todo').type('Третя задача{enter}')
  })

  // Тест 1: Базове використання find()
  // find() - знаходить нащадкові елементи всередині вже знайденого елемента
  it('має знайти вкладені елементи за допомогою find()', () => {
    // cy.get('.todo-list') - спочатку знаходимо батьківський елемент
    // .find('li') - потім знаходимо всі li всередині нього
    // find() шукає на будь-якому рівні вкладеності (не тільки прямі дочірні)
    cy.get('.todo-list')
      .find('li')
      // Перевіряємо, що знайдено 3 елементи
      .should('have.length', 3)
    
    // Знаходимо чекбокси всередині задач
    // .find('.toggle') - знаходить елементи з класом 'toggle' всередині кожної задачі
    cy.get('.todo-list li')
      .find('.toggle')
      // Має бути 3 чекбокси (по одному в кожній задачі)
      .should('have.length', 3)
  })

  // Тест 2: find() vs cy.get() - різниця
  // Важливо розуміти різницю між find() та cy.get()
  it('має показати різницю між find() та cy.get()', () => {
    // cy.get('.todo-list li') - шукає li на всій сторінці, які є нащадками .todo-list
    // Це працює, але менш специфічно
    cy.get('.todo-list li')
      .should('have.length', 3)
    
    // cy.get('.todo-list').find('li') - спочатку знаходить .todo-list,
    // потім шукає li ТІЛЬКИ всередині нього
    // Це більш читабельний та безпечний підхід
    cy.get('.todo-list')
      .find('li')
      .should('have.length', 3)
    
    // Висновок: find() краще використовувати, коли вже є батьківський елемент
  })

  // Тест 3: Базове використання contains()
  // contains() - знаходить елемент, який містить вказаний текст
  it('має знайти елементи за текстом через contains()', () => {
    // cy.contains('Перша задача') - знаходить перший елемент, що містить текст "Перша задача"
    // contains() шукає часткове співпадіння (не обов'язково точне)
    cy.contains('Перша задача')
      .should('exist')
    
    // cy.contains('Перша') - знайде той самий елемент, бо містить "Перша"
    // contains() працює з частковим співпадінням
    cy.contains('Перша')
      .should('exist')
      .should('contain', 'Перша задача')
  })

  // Тест 4: contains() з селектором
  // contains() можна комбінувати з селектором для точнішого пошуку
  it('має використовувати contains() з селектором', () => {
    // cy.contains('.todo-list li', 'Перша') - знаходить li всередині .todo-list,
    // який містить текст "Перша"
    // Це більш специфічний пошук, ніж просто cy.contains('Перша')
    cy.contains('.todo-list li', 'Перша')
      .should('exist')
      .should('contain', 'Перша задача')
    
    // cy.contains('li', 'Друга') - знаходить li, який містить "Друга"
    // Без вказівки батьківського елемента шукає по всій сторінці
    cy.contains('li', 'Друга')
      .should('exist')
  })

  // Тест 5: contains() як метод ланцюжка
  // contains() можна викликати на вже знайденому елементі
  it('має використовувати contains() як метод ланцюжка', () => {
    // cy.get('.todo-list') - знаходимо батьківський елемент
    // .contains('Перша') - шукаємо текст всередині нього
    // Це еквівалентно cy.contains('.todo-list', 'Перша')
    cy.get('.todo-list')
      .contains('Перша')
      .should('exist')
    
    // Комбінація find() та contains()
    // .find('li') - знаходимо всі li
    // .contains('Третя') - серед них шукаємо той, що містить "Третя"
    cy.get('.todo-list')
      .find('li')
      .contains('Третя')
      .should('exist')
  })

  // Тест 6: contains() знаходить тільки перший елемент
  // Важливо: contains() повертає тільки ПЕРШИЙ елемент, що відповідає умові
  it('має знайти тільки перший елемент через contains()', () => {
    // Додаємо дві задачі з однаковим текстом
    cy.get('.new-todo').type('Однакова задача{enter}')
    cy.get('.new-todo').type('Однакова задача{enter}')
    
    // cy.contains('Однакова задача') - знайде тільки ПЕРШИЙ елемент
    // На відміну від cy.get(), який знайде всі елементи
    cy.contains('Однакова задача')
      .should('exist')
      // Але це буде тільки один елемент, не два!
      .should('have.length', 1)
    
    // Якщо потрібно знайти всі елементи з текстом, використовуйте cy.get() + filter()
    cy.get('.todo-list li')
      .filter(':contains("Однакова задача")')
      // Тепер знайдено обидва елементи
      .should('have.length', 2)
  })

  // Тест 7: Практичний приклад - пошук та взаємодія
  // Комбінація find() та contains() для реальних сценаріїв
  it('має використовувати find() та contains() для взаємодії', () => {
    // Знаходимо задачу за текстом та відмічаємо її як виконану
    // cy.contains('.todo-list li', 'Друга') - знаходимо задачу "Друга задача"
    // .find('.toggle') - знаходимо чекбокс всередині неї
    // .check() - відмічаємо як виконану
    cy.contains('.todo-list li', 'Друга')
      .find('.toggle')
      .check()
    
    // Перевіряємо, що задача відмічена
    // cy.contains() вже повертає li елемент, тому не потрібен parent()
    // .should('have.class', 'completed') - перевіряємо, що додано клас 'completed'
    cy.contains('.todo-list li', 'Друга')
      .should('have.class', 'completed')
  })

  // Тест 8: Регістрочність та точність пошуку
  // contains() чутливий до регістру та шукає часткове співпадіння
  it('має враховувати регістрочність та точність пошуку', () => {
    // contains() чутливий до регістру (великі/малі літери)
    // cy.contains('ПЕРША') - НЕ знайде "Перша задача" (різний регістр)
    // cy.contains('Перша') - знайде "Перша задача" (часткове співпадіння)
    cy.contains('Перша')
      .should('exist')
    
    // contains() шукає часткове співпадіння
    // "Перша" знайде "Перша задача", "Перша нова задача" тощо
    cy.contains('Перша')
      .should('contain', 'Перша задача')
  })
})

// ============================================================
// ВАЖЛИВІ ЗАУВАЖЕННЯ про find() та contains():
// ============================================================
// find():
// - Шукає нащадкові елементи всередині вже знайденого елемента
// - Працює на будь-якому рівні вкладеності (не тільки прямі дочірні)
// - Краще використовувати замість складних селекторів у cy.get()
// - Покращує читабельність коду
//
// contains():
// - Знаходить елемент за текстовим вмістом (часткове співпадіння)
// - Повертає тільки ПЕРШИЙ елемент, що відповідає умові
// - Чутливий до регістру (великі/малі літери)
// - Може працювати як окрема команда або як метод ланцюжка
// - Краще для пошуку за текстом, ніж складні CSS селектори
// ============================================================
