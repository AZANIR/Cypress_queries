// ============================================================
// ТЕМА: Комбінована фільтрація - складні приклади
// ОПИС: Демонстрація комбінації різних методів фільтрації
//       для вирішення складних завдань
// ============================================================

describe('Комбінована фільтрація - складні сценарії', () => {
  // Підготовка: відкриваємо сторінку та додаємо різноманітні дані
  beforeEach(() => {
    cy.visit('/')
    // Додаємо різні задачі для складних тестів
    cy.get('.new-todo').type('Важлива активна задача{enter}')
    cy.get('.new-todo').type('Звичайна активна задача{enter}')
    cy.get('.new-todo').type('Виконана важлива задача{enter}')
    cy.get('.new-todo').type('Виконана звичайна задача{enter}')
    // Відмічаємо третю та четверту задачі як виконані
    cy.get('.todo-list li').eq(2).find('.toggle').check()
    cy.get('.todo-list li').eq(3).find('.toggle').check()
  })

  // Тест 1: Комбінація filter() та not()
  // Використання обох методів для точного вибору елементів
  it('має комбінувати filter() та not() для складного вибору', () => {
    // Знаходимо активні задачі, що містять "Важлива"
    // .not('.completed') - виключаємо виконані
    // .filter(':contains("Важлива")') - залишаємо тільки з текстом "Важлива"
    cy.get('.todo-list li')
      .not('.completed')
      .filter(':contains("Важлива")')
      // Має бути тільки одна активна важлива задача
      .should('have.length', 1)
      .should('contain', 'Важлива активна задача')
  })

  // Тест 2: Множинна фільтрація
  // Застосування кількох фільтрів послідовно
  it('має застосовувати множинну фільтрацію', () => {
    // Спочатку виключаємо виконані
    // Потім фільтруємо за текстом
    // Потім беремо перший елемент
    cy.get('.todo-list li')
      .not('.completed')
      .filter(':contains("Звичайна")')
      .first()
      .should('contain', 'Звичайна активна задача')
  })

  // Тест 3: Фільтрація з перевіркою стану
  // Комбінація фільтрації з перевіркою стану елементів
  it('має фільтрувати з перевіркою стану', () => {
    // Знаходимо всі виконані задачі
    cy.get('.todo-list li')
      .filter('.completed')
      // Перевіряємо, що всі вони дійсно виконані
      .each(($el) => {
        // each() - ітеруємо по кожному елементу
        // $el - поточний jQuery елемент
        cy.wrap($el)
          .should('have.class', 'completed')
      })
  })

  // Тест 4: Фільтрація за складними умовами
  // Використання функцій для складних умов фільтрації
  it('має фільтрувати за складними умовами', () => {
    // Фільтруємо задачі, що містять "Важлива" або "Звичайна"
    // Використовуємо функцію для складних умов
    cy.get('.todo-list li')
      .filter((el) => {
        const text = Cypress.$(el).text()
        // Залишаємо тільки задачі, що містять "Важлива" або "Звичайна"
        return text.includes('Важлива') || text.includes('Звичайна')
      })
      // Має бути 4 задачі (всі містять одне з цих слів)
      .should('have.length', 4)
  })

  // Тест 5: Фільтрація з підрахунком
  // Використання фільтрації для підрахунку елементів
  it('має використовувати фільтрацію для підрахунку', () => {
    // Підраховуємо активні задачі
    cy.get('.todo-list li')
      .not('.completed')
      .should('have.length', 2)
    
    // Підраховуємо виконані задачі
    cy.get('.todo-list li')
      .filter('.completed')
      .should('have.length', 2)
    
    // Підраховуємо важливі задачі (активні та виконані)
    // Використовуємо :contains() для пошуку за текстом
    cy.get('.todo-list li')
      .filter(':contains("Важлива")')
      .should('have.length', 2)
  })

  // Тест 6: Практичний сценарій - масові операції
  // Використання фільтрації для масових операцій над елементами
  it('має використовувати фільтрацію для масових операцій', () => {
    // Знаходимо всі активні задачі та відмічаємо їх як виконані
    cy.get('.todo-list li')
      .not('.completed')
      .each(($el) => {
        // Для кожної активної задачі знаходимо чекбокс та відмічаємо
        cy.wrap($el)
          .find('.toggle')
          .check()
      })
    
    // Перевіряємо, що всі задачі тепер виконані
    cy.get('.todo-list li')
      .filter('.completed')
      .should('have.length', 4)
  })

  // Тест 7: Фільтрація з навігацією
  // Комбінація фільтрації з навігаційними методами
  it('має комбінувати фільтрацію з навігацією', () => {
    // Знаходимо активні задачі
    cy.get('.todo-list li')
      .not('.completed')
      // Беремо першу активну задачу
      .first()
      // Знаходимо її сусідні елементи
      .siblings('li')
      // Фільтруємо тільки виконані
      .filter('.completed')
      // Перевіряємо кількість виконаних сусідніх задач
      .should('have.length', 2)
  })
})

// ============================================================
// НАЙКРАЩІ ПРАКТИКИ для комбінованої фільтрації:
// ============================================================
// 1. Використовуйте not() для виключення, filter() для включення
// 2. Комбінуйте методи послідовно для складних умов
// 3. Використовуйте функції для дуже складних умов
// 4. Перевіряйте результати фільтрації перед взаємодією
// 5. Документуйте складні умови фільтрації коментарями
// 6. Розбивайте складні фільтри на простіші кроки для читабельності
// ============================================================
