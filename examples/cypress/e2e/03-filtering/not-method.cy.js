// ============================================================
// ТЕМА: Метод not() - виключення елементів з вибору
// ОПИС: Демонстрація використання not() для виключення
//       елементів, що не відповідають умовам
// ============================================================

describe('Метод not() - виключення елементів', () => {
  // Підготовка: відкриваємо сторінку та додаємо тестові дані
  beforeEach(() => {
    cy.visit('/')
    // Додаємо кілька задач
    cy.get('.new-todo').type('Активна задача 1{enter}')
    cy.get('.new-todo').type('Активна задача 2{enter}')
    cy.get('.new-todo').type('Виконана задача{enter}')
    // Відмічаємо третю задачу як виконану
    cy.get('.todo-list li').last().find('.toggle').check()
  })

  // Тест 1: Базове використання not()
  // not() - виключає елементи, що відповідають умові
  it('має виключити елементи за класом через not()', () => {
    // cy.get('.todo-list li') - знаходимо всі задачі
    // .not('.completed') - виключаємо задачі з класом 'completed'
    // Результат - тільки активні (невиконані) задачі
    cy.get('.todo-list li')
      .not('.completed')
      // Має залишитися 2 активні задачі
      .should('have.length', 2)
  })

  // Тест 2: not() з псевдокласами
  // not() підтримує CSS псевдокласи для виключення за станом
  it('має використовувати not() з псевдокласами', () => {
    // .not(':visible') - виключаємо невидимі елементи
    // У нашому випадку всі задачі видимі, тому результат не зміниться
    cy.get('.todo-list li')
      .not(':hidden')
      .should('have.length', 3)
    
    // .not(':checked') - виключаємо відмічені чекбокси
    // Але це працює на чекбоксах, а не на li елементах
    cy.get('.todo-list li .toggle')
      .not(':checked')
      // Має бути 2 невідмічені чекбокси
      .should('have.length', 2)
  })

  // Тест 3: not() з текстом
  // not() може виключати елементи за текстовим вмістом
  it('має виключати елементи за текстом через not()', () => {
    // .not(':contains("Виконана")') - виключаємо задачі, що містять "Виконана"
    // Результат - тільки задачі без слова "Виконана"
    cy.get('.todo-list li')
      .not(':contains("Виконана")')
      // Має залишитися 2 задачі
      .should('have.length', 2)
      // Перевіряємо, що це дійсно активні задачі
      .first()
      .should('contain', 'Активна')
  })

  // Тест 4: not() з функцією
  // not() може приймати функцію для складнішого виключення
  it('має використовувати not() з функцією', () => {
    // .not((el) => ...) - передаємо функцію для виключення
    // el - це DOM елемент, потрібно обгорнути в Cypress.$() для jQuery методів
    // Виключаємо задачі, що мають клас 'completed' (виконані)
    // not() виключає елементи, для яких функція повертає true
    cy.get('.todo-list li')
      .not((el) => {
        return Cypress.$(el).hasClass('completed')
      })
      .should('have.length', 2)
  })

  // Тест 5: Комбінація not() з filter()
  // not() та filter() можна комбінувати для складних пошуків
  it('має комбінувати not() з filter()', () => {
    // Спочатку виключаємо виконані, потім фільтруємо за текстом
    cy.get('.todo-list li')
      .not('.completed')
      .filter(':contains("Активна")')
      // Має бути 2 активні задачі
      .should('have.length', 2)
  })

  // Тест 6: Практичний приклад - вибір активних задач
  // Використання not() для вибору тільки активних задач
  it('має використовувати not() для вибору активних задач', () => {
    // Знаходимо тільки активні (невиконані) задачі
    cy.get('.todo-list li')
      .not('.completed')
      // Перевіряємо кількість
      .should('have.length', 2)
      // Відмічаємо першу активну задачу
      .first()
      .find('.toggle')
      .check()
    
    // Перевіряємо, що тепер є 2 виконані задачі
    cy.get('.todo-list li')
      .filter('.completed')
      .should('have.length', 2)
  })

  // Тест 7: not() vs filter() - коли що використовувати
  // Важливо розуміти різницю між not() та filter()
  it('має показати різницю між not() та filter()', () => {
    // not() - виключає елементи
    // .not('.completed') - виключає виконані
    cy.get('.todo-list li')
      .not('.completed')
      .should('have.length', 2)
    
    // filter() - залишає тільки елементи, що відповідають умові
    // .filter(':not(.completed)') - залишає тільки невиконані
    // Це еквівалентно .not('.completed')
    cy.get('.todo-list li')
      .filter(':not(.completed)')
      .should('have.length', 2)
    
    // Висновок: not() та filter(':not()') дають однаковий результат
    // Але not() більш читабельний для простих випадків
  })
})

// ============================================================
// ВАЖЛИВІ ЗАУВАЖЕННЯ про not():
// ============================================================
// 1. not() виключає елементи, що відповідають умові
// 2. not() працює на вже знайдених елементах
// 3. not() підтримує CSS селектори та псевдокласи
// 4. not() може приймати функцію для складнішого виключення
// 5. not('.class') еквівалентно filter(':not(.class)')
// 6. Використовуйте not() коли потрібно виключити елементи
// 7. not() більш читабельний за filter(':not()') для простих випадків
// ============================================================
