// ============================================================
// ТЕМА: Метод within() - обмеження контексту пошуку
// ОПИС: Демонстрація використання within() для обмеження
//       пошуку елементів певною областю DOM
// ============================================================

describe('Метод within() - обмеження контексту', () => {
  // Підготовка: відкриваємо сторінку та додаємо тестові дані
  beforeEach(() => {
    cy.visit('/')
    cy.get('.new-todo').type('Задача 1{enter}')
    cy.get('.new-todo').type('Задача 2{enter}')
  })

  // Тест 1: Базове використання within()
  // within() - обмежує пошук елементів всередині вказаного контейнера
  it('має обмежити пошук всередині контейнера через within()', () => {
    // cy.get('.todo-list') - знаходимо контейнер
    // .within(() => { ... }) - обмежуємо пошук всередині цього контейнера
    // Всі cy.get() всередині within() шукають тільки всередині контейнера
    cy.get('.todo-list').within(() => {
      // cy.get('li') - шукає li тільки всередині .todo-list
      // Не знайде li з інших частин сторінки
      cy.get('li')
        .should('have.length', 2)
    })
  })

  // Тест 2: within() для уникнення конфліктів селекторів
  // within() корисний, коли на сторінці є кілька елементів з однаковими селекторами
  it('має використовувати within() для уникнення конфліктів', () => {
    // Якщо б на сторінці було кілька .todo-list,
    // within() гарантує, що ми працюємо з правильним
    cy.get('.todo-list').within(() => {
      // Всі команди всередині працюють тільки з елементами всередині .todo-list
      cy.get('li')
        .first()
        .should('contain', 'Задача 1')
    })
  })

  // Тест 3: within() для групування операцій
  // within() дозволяє групувати операції над елементами одного контейнера
  it('має групувати операції через within()', () => {
    // Всі операції всередині within() працюють з одним контейнером
    cy.get('.todo-list').within(() => {
      // Знаходимо першу задачу
      cy.get('li')
        .first()
        .should('exist')
      
      // Знаходимо чекбокс першої задачі
      cy.get('li')
        .first()
        .find('.toggle')
        .check()
      
      // Перевіряємо результат
      cy.get('li.completed')
        .should('have.length', 1)
    })
  })

  // Тест 4: Вкладені within()
  // within() можна вкладати для ще більш специфічного контексту
  it('має використовувати вкладені within()', () => {
    // Зовнішній within() - обмежуємо .todo-list
    cy.get('.todo-list').within(() => {
      // Внутрішній within() - обмежуємо перший li
      cy.get('li').first().within(() => {
        // Тепер пошук обмежений тільки першим li
        cy.get('.toggle')
          .should('exist')
          .check()
      })
    })
  })

  // Тест 5: Практичний приклад - форма
  // within() особливо корисний для роботи з формами
  it('має демонструвати практичне використання within()', () => {
    // Уявімо, що .todo-list - це форма
    // within() гарантує, що ми працюємо тільки з елементами цієї форми
    cy.get('.todo-list').within(() => {
      // Всі операції всередині працюють тільки з елементами списку
      cy.get('li')
        .should('have.length', 2)
      
      cy.get('li')
        .each(($el) => {
          cy.wrap($el)
            .should('be.visible')
        })
    })
  })
})

// ============================================================
// ВАЖЛИВІ ЗАУВАЖЕННЯ про within():
// ============================================================
// 1. within() обмежує пошук елементів всередині вказаного контейнера
// 2. Всі cy.get() всередині within() шукають тільки всередині контейнера
// 3. within() корисний для уникнення конфліктів селекторів
// 4. within() дозволяє групувати операції над одним контейнером
// 5. within() можна вкладати для ще більш специфічного контексту
// 6. Використовуйте within() для покращення читабельності та безпеки тестів
// ============================================================
